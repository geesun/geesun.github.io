<!DOCTYPE html>
<html lang="cn">
<head>
        <meta charset="utf-8" />
        <title>对Git Fast-Forword和Rebase理解</title>
        <link rel="stylesheet" href="../../../theme/css/main.css" />
        <link href="https://geesun.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Geesun's Blog Atom Feed" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../../../">Geesun's Blog </a></h1>
                <nav><ul>
                    <li><a href="../../../category/leetcode.html">Leetcode</a></li>
                    <li class="active"><a href="../../../category/misc.html">Misc</a></li>
                    <li><a href="../../../category/network.html">Network</a></li>
                    <li><a href="../../../category/program.html">Program</a></li>
                    <li><a href="../../../category/vim.html">VIM</a></li>
                </ul>
                </nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="../../../posts/2015/09/git_fast_forword_rebase.html" rel="bookmark"
           title="Permalink to 对Git Fast-Forword和Rebase理解">对Git Fast-Forword和Rebase理解</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <span>四 24 九月 2015</span>
<span>| tags: <a href="../../../tag/git.html">git</a></span>
</footer><!-- /.post-info -->      <h2>问题</h2>
<h3>遇到什么问题?</h3>
<p>之前日常操作都是用git pull来获取远程代码并且自动合并，如果和远程代码有分叉的话，就会出现一些奇怪的提交，如下面的提交记录：</p>
<div class="highlight"><pre><span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">git</span> <span class="n">log</span> 
<span class="n">commit</span> <span class="mi">0</span><span class="n">c2df7467d30c46ee4884eb170cf4a521918e7d3</span>
<span class="nl">Merge:</span> <span class="mi">2</span><span class="n">ce37bb</span> <span class="mf">236e1</span><span class="n">d3</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">14</span><span class="o">:</span><span class="mi">19</span><span class="o">:</span><span class="mi">49</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">Merge</span> <span class="n">branch</span> <span class="err">&#39;</span><span class="n">master</span><span class="err">&#39;</span> <span class="n">of</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">geesun</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">remote</span>
</pre></div>


<p>很多情况下，我们并不希望有这样的自动合并产生，因为他产生了一个自动提交，会让版本变得交叉，不清晰。</p>
<h3>问题如何产生?</h3>
<p>Step 1:本地代码从远程服务器的同步完成后又提交了B,这是本地代码提交记录:</p>
<div class="highlight"><pre><span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">git</span> <span class="n">log</span> 
<span class="n">commit</span> <span class="mi">2</span><span class="n">ce37bbfd25d5e0265cda4949b16f0110a4f45e7</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">14</span><span class="o">:</span><span class="mi">18</span><span class="o">:</span><span class="mi">40</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">Check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">B</span>

<span class="n">commit</span> <span class="mi">9</span><span class="n">d34ed98d4478fa52424498940c962f9b0d921e2</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">14</span><span class="o">:</span><span class="mi">17</span><span class="o">:</span><span class="mo">02</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">base</span> 
</pre></div>


<p>Step 2: 远程服务后来又被另外一个人提交了A,远程服务器的提交记录如下:</p>
<div class="highlight"><pre><span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">remote</span><span class="err">$</span> <span class="n">git</span> <span class="n">log</span>
<span class="n">commit</span> <span class="mf">236e1</span><span class="n">d369761e180e4928a717c180d5cb776ba02</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">14</span><span class="o">:</span><span class="mi">18</span><span class="o">:</span><span class="mi">19</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">Check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">A</span>

<span class="n">commit</span> <span class="mi">9</span><span class="n">d34ed98d4478fa52424498940c962f9b0d921e2</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">14</span><span class="o">:</span><span class="mi">17</span><span class="o">:</span><span class="mo">02</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">base</span>
</pre></div>


<p>Step 3:这个时候我要在本地push代码到远程服务器,会被reject,必须先同步才能push,就用git pull同步,操作结果如下:</p>
<div class="highlight"><pre><span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">git</span> <span class="n">pull</span> 
<span class="nl">remote:</span> <span class="n">Counting</span> <span class="n">objects</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span> <span class="n">done</span><span class="p">.</span>
<span class="nl">remote:</span> <span class="n">Compressing</span> <span class="n">objects</span><span class="o">:</span> <span class="mi">100</span><span class="o">%</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">done</span><span class="p">.</span>
<span class="nl">remote:</span> <span class="n">Total</span> <span class="mi">3</span> <span class="p">(</span><span class="n">delta</span> <span class="mi">0</span><span class="p">),</span> <span class="n">reused</span> <span class="mi">0</span> <span class="p">(</span><span class="n">delta</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">Unpacking</span> <span class="n">objects</span><span class="o">:</span> <span class="mi">100</span><span class="o">%</span> <span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span> <span class="n">done</span><span class="p">.</span>
<span class="err">来自</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">geesun</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">remote</span>
   <span class="mi">9</span><span class="n">d34ed9</span><span class="p">.</span><span class="mf">.236e1</span><span class="n">d3</span>  <span class="n">master</span>     <span class="o">-&gt;</span> <span class="n">origin</span><span class="o">/</span><span class="n">master</span>
<span class="n">Merge</span> <span class="n">made</span> <span class="n">by</span> <span class="n">the</span> <span class="err">&#39;</span><span class="n">recursive</span><span class="err">&#39;</span> <span class="n">strategy</span><span class="p">.</span>
 <span class="n">local1</span> <span class="o">|</span> <span class="mi">1</span> <span class="o">+</span>
 <span class="mi">1</span> <span class="n">file</span> <span class="n">changed</span><span class="p">,</span> <span class="mi">1</span> <span class="n">insertion</span><span class="p">(</span><span class="o">+</span><span class="p">)</span>
 <span class="n">create</span> <span class="n">mode</span> <span class="mi">100644</span> <span class="n">local1</span>
<span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">git</span> <span class="n">log</span> 
<span class="n">commit</span> <span class="mi">0</span><span class="n">c2df7467d30c46ee4884eb170cf4a521918e7d3</span>
<span class="nl">Merge:</span> <span class="mi">2</span><span class="n">ce37bb</span> <span class="mf">236e1</span><span class="n">d3</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">14</span><span class="o">:</span><span class="mi">19</span><span class="o">:</span><span class="mi">49</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">Merge</span> <span class="n">branch</span> <span class="err">&#39;</span><span class="n">master</span><span class="err">&#39;</span> <span class="n">of</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">geesun</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">remote</span>

<span class="n">commit</span> <span class="mi">2</span><span class="n">ce37bbfd25d5e0265cda4949b16f0110a4f45e7</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">14</span><span class="o">:</span><span class="mi">18</span><span class="o">:</span><span class="mi">40</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">Check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">B</span>

<span class="n">commit</span> <span class="mf">236e1</span><span class="n">d369761e180e4928a717c180d5cb776ba02</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">14</span><span class="o">:</span><span class="mi">18</span><span class="o">:</span><span class="mi">19</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">Check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">A</span>

<span class="n">commit</span> <span class="mi">9</span><span class="n">d34ed98d4478fa52424498940c962f9b0d921e2</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">14</span><span class="o">:</span><span class="mi">17</span><span class="o">:</span><span class="mo">02</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">base</span>
</pre></div>


<p>这个时候别人在从远程服务器同步代码之后,都会看到开始那条本不该存在的提交记录.</p>
<h3>如何解决这个问题</h3>
<p>在本地代码推送到远程服务器之前,对本地代码进行rebase即可,操作记录:</p>
<div class="highlight"><pre><span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">git</span> <span class="n">pull</span> <span class="o">-</span><span class="n">r</span> 
<span class="err">首先，重置头指针以便在上面重放您的工作</span><span class="p">...</span>
<span class="err">正应用：</span><span class="n">check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">B</span>
<span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">git</span> <span class="n">log</span> 
<span class="n">commit</span> <span class="mi">2</span><span class="n">ce37bbfd25d5e0265cda4949b16f0110a4f45e7</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">14</span><span class="o">:</span><span class="mi">18</span><span class="o">:</span><span class="mi">40</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">B</span>

<span class="n">commit</span> <span class="mf">236e1</span><span class="n">d369761e180e4928a717c180d5cb776ba02</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">14</span><span class="o">:</span><span class="mi">18</span><span class="o">:</span><span class="mi">19</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">Check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">A</span>

<span class="n">commit</span> <span class="mi">9</span><span class="n">d34ed98d4478fa52424498940c962f9b0d921e2</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">14</span><span class="o">:</span><span class="mi">17</span><span class="o">:</span><span class="mo">02</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">base</span> <span class="n">check</span> <span class="n">in</span>
</pre></div>


<h2>什么是Fast-Forward</h2>
<p>要理解rebase,就先要搞清楚Fast-Forward的概念. 如果本地代码在跟远程同步之后,本地没有新的提交,而远程代码有新的提交,这就是说本地代码和远程的代码没有出现分叉,只不过是本地代码指向比较旧的版本而已.这种情况我们就称为本地代码可以做Fast-Forward. </p>
<p>如下:</p>
<div class="highlight"><pre>BASE<span class="o">---&gt;</span>A      <span class="o">&lt;---</span> <span class="p">[</span>Local master<span class="p">]</span>
                \
                 \
                  B   <span class="o">&lt;---</span> <span class="p">[</span>Remote master<span class="p">]</span>
</pre></div>


<p>操作记录:</p>
<p>远端:</p>
<div class="highlight"><pre><span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">remote</span><span class="err">$</span> <span class="n">git</span> <span class="n">log</span> 
<span class="n">commit</span> <span class="mi">257</span><span class="n">d73fdbbfbaaaac18a398e46bf296cc01436ca</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">40</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">B</span>

<span class="n">commit</span> <span class="mf">236e1</span><span class="n">d369761e180e4928a717c180d5cb776ba02</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">14</span><span class="o">:</span><span class="mi">18</span><span class="o">:</span><span class="mi">19</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">A</span>

<span class="n">commit</span> <span class="mi">9</span><span class="n">d34ed98d4478fa52424498940c962f9b0d921e2</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">14</span><span class="o">:</span><span class="mi">17</span><span class="o">:</span><span class="mo">02</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">base</span>
</pre></div>


<p>本地:</p>
<div class="highlight"><pre><span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">git</span> <span class="n">log</span> 
<span class="n">commit</span> <span class="mf">236e1</span><span class="n">d369761e180e4928a717c180d5cb776ba02</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">14</span><span class="o">:</span><span class="mi">18</span><span class="o">:</span><span class="mi">19</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">A</span>

<span class="n">commit</span> <span class="mi">9</span><span class="n">d34ed98d4478fa52424498940c962f9b0d921e2</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">14</span><span class="o">:</span><span class="mi">17</span><span class="o">:</span><span class="mo">02</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">base</span>
<span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">git</span> <span class="n">pull</span> 
<span class="err">更新</span> <span class="mf">236e1</span><span class="n">d3</span><span class="p">.</span><span class="mf">.257</span><span class="n">d73f</span>
<span class="n">Fast</span><span class="o">-</span><span class="n">forward</span>
 <span class="n">local2</span> <span class="o">|</span> <span class="mi">1</span> <span class="o">+</span>
 <span class="mi">1</span> <span class="n">file</span> <span class="n">changed</span><span class="p">,</span> <span class="mi">1</span> <span class="n">insertion</span><span class="p">(</span><span class="o">+</span><span class="p">)</span>
 <span class="n">create</span> <span class="n">mode</span> <span class="mi">100644</span> <span class="n">local2</span>
<span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">git</span> <span class="n">log</span>
<span class="n">commit</span> <span class="mi">257</span><span class="n">d73fdbbfbaaaac18a398e46bf296cc01436ca</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">40</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">B</span>

<span class="n">commit</span> <span class="mf">236e1</span><span class="n">d369761e180e4928a717c180d5cb776ba02</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">14</span><span class="o">:</span><span class="mi">18</span><span class="o">:</span><span class="mi">19</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">A</span>

<span class="n">commit</span> <span class="mi">9</span><span class="n">d34ed98d4478fa52424498940c962f9b0d921e2</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">14</span><span class="o">:</span><span class="mi">17</span><span class="o">:</span><span class="mo">02</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">base</span> 
</pre></div>


<p><strong> 这里的git pull相当于 git fetch和git merge origin/master的组合. </strong></p>
<p>因为这种情况是可以做fast-forward,所以git merge就相当于只是做了fast-forward而已.</p>
<p>开始问题描述的就是一种不可以做fast-forward的情况,如果再用git merge则就会产生一个自动提交,如开始问题描述的一样.</p>
<p>有些时候我们希望能fast-forward就fast-forward,否则我们用后面会讲的rebase命令合并。可以这样：</p>
<div class="highlight"><pre><span class="n">git</span> <span class="n">pull</span> <span class="o">--</span><span class="n">ff</span><span class="o">-</span><span class="n">only</span>
</pre></div>


<p>或者</p>
<div class="highlight"><pre><span class="n">git</span> <span class="n">fetch</span>
<span class="n">git</span> <span class="n">merge</span> <span class="o">--</span><span class="n">ff</span><span class="o">-</span><span class="n">only</span> <span class="n">origin</span><span class="o">/</span><span class="n">master</span>
</pre></div>


<p>如果不能fast-forward, merge 操作会终止。</p>
<h2>什么是Rebase</h2>
<p>Rebase就是同步本地和远程的分支,使它们的base一样,然再应用本地没有推送的提交. </p>
<p>git rebase是时做了如下三件事情:</p>
<ol>
<li>把本地未推送到远端的所有提交，放到暂存区。</li>
<li>然后把本地的指针指向远端的最新提交,也就使它和远端的提交一样.</li>
<li>然后将暂存区的提交挨个挨个提交到本分支. 如果出现冲突,会需要手工merge.</li>
</ol>
<p>远端提交记录:</p>
<div class="highlight"><pre><span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">remote</span><span class="err">$</span> <span class="n">git</span> <span class="n">log</span> 
<span class="n">commit</span> <span class="mi">0</span><span class="n">ab394dc2ac5a4d186eb9be86da4c72987d3023a</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">16</span><span class="o">:</span><span class="mi">37</span><span class="o">:</span><span class="mi">37</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">Check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">A</span>

<span class="n">commit</span> <span class="mf">88e8</span><span class="n">afd5519fe8eaf7b9e3bb04635567d83eeeee</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">16</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mi">30</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">base</span>
</pre></div>


<p>本地提交记录:</p>
<div class="highlight"><pre><span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">git</span> <span class="n">log</span> 
<span class="n">commit</span> <span class="n">df94a3c6cf05c63a7b9db6fd753ef70b1d9a40df</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">16</span><span class="o">:</span><span class="mi">45</span><span class="o">:</span><span class="mi">21</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">Check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">B</span>

<span class="n">commit</span> <span class="mf">88e8</span><span class="n">afd5519fe8eaf7b9e3bb04635567d83eeeee</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">16</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mi">30</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">base</span>
</pre></div>


<p>对本地进行rebase:</p>
<div class="highlight"><pre><span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">git</span> <span class="n">pull</span> <span class="o">-</span><span class="n">r</span> 
<span class="err">首先，重置头指针以便在上面重放您的工作</span><span class="p">...</span>
<span class="err">正应用：</span><span class="n">Check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">B</span>
<span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">git</span> <span class="n">log</span> 
<span class="n">commit</span> <span class="mf">59e14</span><span class="n">ba0bb2e55401ca0b2d8c309f520843e8144</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">16</span><span class="o">:</span><span class="mi">45</span><span class="o">:</span><span class="mi">21</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">Check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">B</span>

<span class="n">commit</span> <span class="mi">0</span><span class="n">ab394dc2ac5a4d186eb9be86da4c72987d3023a</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">16</span><span class="o">:</span><span class="mi">37</span><span class="o">:</span><span class="mi">37</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">Check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">A</span>

<span class="n">commit</span> <span class="mf">88e8</span><span class="n">afd5519fe8eaf7b9e3bb04635567d83eeeee</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">16</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mi">30</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">base</span>
</pre></div>


<p>Rebase后的结果也许是我们希望的结果,而不是开始问题描述的那样.</p>
<p><strong> 这里的git pull -r 相当于 git fetch和git rebase的组合. </strong></p>
<p>如果rebase出现冲突,会需要手工merge</p>
<p>手工merge操作日志:</p>
<div class="highlight"><pre><span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">git</span> <span class="n">log</span> 
<span class="n">commit</span> <span class="n">e6bb6173b626f8ef599b86516a0e35e4cbb7bc5a</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">16</span><span class="o">:</span><span class="mi">51</span><span class="o">:</span><span class="mo">02</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">Check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">B</span>

<span class="n">commit</span> <span class="mf">88e8</span><span class="n">afd5519fe8eaf7b9e3bb04635567d83eeeee</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">16</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mi">30</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">base</span>
<span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">git</span> <span class="n">rebase</span>
<span class="err">首先，重置头指针以便在上面重放您的工作</span><span class="p">...</span>
<span class="err">正应用：</span><span class="n">Check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">B</span>
<span class="err">使用索引来重建一个（三路合并的）基础目录树</span><span class="p">...</span>
<span class="err">转而在基础版本上打补丁及进行三路合并</span><span class="p">...</span>
<span class="err">自动合并</span> <span class="n">test</span><span class="p">.</span><span class="n">txt</span>
<span class="err">冲突（添加</span><span class="o">/</span><span class="err">添加）：合并冲突于</span> <span class="n">test</span><span class="p">.</span><span class="n">txt</span>
<span class="err">无法合并变更。</span>
<span class="err">补丁失败于</span> <span class="mo">0001</span> <span class="n">Check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">B</span>
<span class="err">失败的补丁文件副本位于：</span>
   <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">geesun</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="p">.</span><span class="n">git</span><span class="o">/</span><span class="n">rebase</span><span class="o">-</span><span class="n">apply</span><span class="o">/</span><span class="n">patch</span>

<span class="err">当您解决了此问题后，执行</span> <span class="s">&quot;git rebase --continue&quot;</span><span class="err">。</span>
<span class="err">如果您想跳过此补丁，则执行</span> <span class="s">&quot;git rebase --skip&quot;</span><span class="err">。</span>
<span class="err">要恢复原分支并停止变基，执行</span> <span class="s">&quot;git rebase --abort&quot;</span><span class="err">。</span>

<span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">vi</span> <span class="n">test</span><span class="p">.</span><span class="n">txt</span>
<span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">git</span> <span class="n">add</span> <span class="n">test</span><span class="p">.</span><span class="n">txt</span>
<span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">git</span> <span class="n">rebase</span> <span class="o">--</span><span class="k">continue</span>
<span class="err">正应用：</span><span class="n">Check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">B</span>
<span class="n">geesun</span><span class="err">@</span><span class="n">geesun</span><span class="o">-</span><span class="n">OptiPlex</span><span class="o">-</span><span class="mi">3010</span><span class="o">:~/</span><span class="n">test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">git</span> <span class="n">log</span> 
<span class="n">commit</span> <span class="mi">0</span><span class="n">a68c730ee96d4dd37d1dd97f52a5fcb4be383e4</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">16</span><span class="o">:</span><span class="mi">51</span><span class="o">:</span><span class="mo">02</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">Check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">B</span>

<span class="n">commit</span> <span class="mi">0</span><span class="n">ab394dc2ac5a4d186eb9be86da4c72987d3023a</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">16</span><span class="o">:</span><span class="mi">37</span><span class="o">:</span><span class="mi">37</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">Check</span> <span class="n">in</span> <span class="n">by</span> <span class="n">A</span>

<span class="n">commit</span> <span class="mf">88e8</span><span class="n">afd5519fe8eaf7b9e3bb04635567d83eeeee</span>
<span class="nl">Author:</span> <span class="n">Geesun</span> <span class="n">Xu</span> <span class="o">&lt;</span><span class="n">geesun</span><span class="err">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date:</span>   <span class="n">Thu</span> <span class="n">Sep</span> <span class="mi">24</span> <span class="mi">16</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mi">30</span> <span class="mi">2015</span> <span class="o">+</span><span class="mi">0800</span>

    <span class="n">base</span>
</pre></div>


<p>不同分支之间也可以做rebase,应该不太常用,就不做例子了.</p>
<h2>总结</h2>
<p>在本地很远端不能做fast-forword的情况下,是采用git merge 还是采用git rebase要看项目的要求. 如果想保持完整的提交记录,可以考虑用git merge. 要想保持清晰的提交记录,采用git rebase会比较好.</p>
<p>git pull默认的行为是merge,如果要更改这种默认行为为rebase,可以用</p>
<div class="highlight"><pre><span class="n">git</span> <span class="n">config</span> <span class="o">--</span><span class="n">global</span> <span class="n">branch</span><span class="p">.</span><span class="n">autosetuprebase</span> <span class="n">always</span>
</pre></div>
    </div><!-- /.entry-content -->
    <div class="comments">
      <h2>Comments !</h2>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_identifier = "posts/2015/09/git_fast_forword_rebase.html";
        var disqus_url = "https://geesun.github.io/posts/2015/09/git_fast_forword_rebase.html";
        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//geesun.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
    </div>

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>个人链接</h2>
                        <ul>
                            <li><a href="https://geesun.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://twitter.com/geesun">Twitter</a></li>
                            <li><a href="https://github.com/geesun">Github</a></li>
                            <li><a href="https://geesun.github.io/resume.html">Resume</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'geesun';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>