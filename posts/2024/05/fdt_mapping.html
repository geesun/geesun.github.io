<!DOCTYPE html>
<html lang="cn">
<head>
        <meta charset="utf-8" />
        <title>FDT的区域的Map过程</title>
        <link rel="stylesheet" href="../../../theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../../../">Linux学习笔记 </a></h1>
                <nav><ul>
                    <li class="active"><a href="../../../category/linux.html">Linux</a></li>
                </ul>
                </nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="../../../posts/2024/05/fdt_mapping.html" rel="bookmark"
           title="Permalink to FDT的区域的Map过程">FDT的区域的Map过程</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <span>Wed 22 May 2024</span>
<span>| tags: <a href="../../../tag/linux.html">Linux</a></span>
</footer><!-- /.post-info -->      <p>u-boot或者uefi启动Linux的时候，会把device tree 所在的地址通过x0寄存器传给Linux。
kernel在boot阶段会使用到x0寄存器，所以在primary_entry -&gt; preserve_boot_args 会把device tree的地址保存到x21寄存器：</p>
<div class="highlight"><pre><span></span><span class="nf">SYM_CODE_START_LOCAL</span><span class="p">(</span><span class="no">preserve_boot_args</span><span class="p">)</span>
<span class="w">        </span><span class="nf">mov</span><span class="w">     </span><span class="no">x21</span><span class="p">,</span><span class="w"> </span><span class="no">x0</span><span class="w">                         </span><span class="c1">// x21=FDT</span>
</pre></div>
<div class="section" id="mapping">
<h2>1:1 mapping阶段</h2>
<p>在init_idmap_pg_dir阶段，会把这个x21地址所对应的物理地址mapping到kernel结尾之后2M对的的地方，这个地方其实不是1:1的映射。 参考：primary_entry -&gt; create_idmap：</p>
<div class="highlight"><pre><span></span><span class="cm">/* Remap the FDT after the kernel image */</span>
<span class="nf">adrp</span><span class="w">    </span><span class="no">x1</span><span class="p">,</span><span class="w"> </span><span class="no">_text</span>
<span class="nf">adrp</span><span class="w">    </span><span class="no">x22</span><span class="p">,</span><span class="w"> </span><span class="no">_end</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="no">SWAPPER_BLOCK_SIZE</span>
<span class="nf">bic</span><span class="w">     </span><span class="no">x2</span><span class="p">,</span><span class="w"> </span><span class="no">x22</span><span class="p">,</span><span class="w"> </span><span class="c1">#SWAPPER_BLOCK_SIZE - 1</span>
<span class="nf">bfi</span><span class="w">     </span><span class="no">x22</span><span class="p">,</span><span class="w"> </span><span class="no">x21</span><span class="p">,</span><span class="w"> </span><span class="mi">#0</span><span class="p">,</span><span class="w"> </span><span class="c1">#SWAPPER_BLOCK_SHIFT              // remapped FDT address</span>
<span class="nf">add</span><span class="w">     </span><span class="no">x3</span><span class="p">,</span><span class="w"> </span><span class="no">x2</span><span class="p">,</span><span class="w"> </span><span class="c1">#MAX_FDT_SIZE + SWAPPER_BLOCK_SIZE</span>
<span class="nf">bic</span><span class="w">     </span><span class="no">x4</span><span class="p">,</span><span class="w"> </span><span class="no">x21</span><span class="p">,</span><span class="w"> </span><span class="c1">#SWAPPER_BLOCK_SIZE - 1</span>
<span class="nf">mov_q</span><span class="w">   </span><span class="no">x5</span><span class="p">,</span><span class="w"> </span><span class="no">SWAPPER_RW_MMUFLAGS</span>
<span class="nf">mov</span><span class="w">     </span><span class="no">x6</span><span class="p">,</span><span class="w"> </span><span class="c1">#SWAPPER_BLOCK_SHIFT</span>
<span class="nf">bl</span><span class="w">      </span><span class="no">remap_region</span>
</pre></div>
<p>可以发现，x22寄存器对应的就是fdt的在使用init_idmap_pg_dir页表阶段的VA，在enable了init_idmap_pg_dir 之后，我们只能使用这个VA来访问fdt的内容。
这也就是为什么在__primary_switch，在调用__pi_kaslr_early_init 之前把x22寄存器赋给x0. 而kaslr_early_init第一个参数就是对应的是fdt的地址。</p>
<div class="highlight"><pre><span></span><span class="nf">SYM_FUNC_START_LOCAL</span><span class="p">(</span><span class="no">__primary_switch</span><span class="p">)</span>
<span class="w">        </span><span class="nf">adrp</span><span class="w">    </span><span class="no">x1</span><span class="p">,</span><span class="w"> </span><span class="no">reserved_pg_dir</span>
<span class="w">        </span><span class="nf">adrp</span><span class="w">    </span><span class="no">x2</span><span class="p">,</span><span class="w"> </span><span class="no">init_idmap_pg_dir</span>
<span class="w">        </span><span class="nf">bl</span><span class="w">      </span><span class="no">__enable_mmu</span>
<span class="c1">#ifdef CONFIG_RELOCATABLE</span>
<span class="w">        </span><span class="nf">adrp</span><span class="w">    </span><span class="no">x23</span><span class="p">,</span><span class="w"> </span><span class="no">KERNEL_START</span>
<span class="w">        </span><span class="nf">and</span><span class="w">     </span><span class="no">x23</span><span class="p">,</span><span class="w"> </span><span class="no">x23</span><span class="p">,</span><span class="w"> </span><span class="no">MIN_KIMG_ALIGN</span><span class="w"> </span><span class="p">-</span><span class="w"> </span><span class="mi">1</span>
<span class="c1">#ifdef CONFIG_RANDOMIZE_BASE</span>
<span class="w">        </span><span class="nf">mov</span><span class="w">     </span><span class="no">x0</span><span class="p">,</span><span class="w"> </span><span class="no">x22</span>
<span class="w">        </span><span class="nf">adrp</span><span class="w">    </span><span class="no">x1</span><span class="p">,</span><span class="w"> </span><span class="no">init_pg_end</span>
<span class="w">        </span><span class="nf">mov</span><span class="w">     </span><span class="no">sp</span><span class="p">,</span><span class="w"> </span><span class="no">x1</span>
<span class="w">        </span><span class="nf">mov</span><span class="w">     </span><span class="no">x29</span><span class="p">,</span><span class="w"> </span><span class="no">xzr</span>
<span class="w">        </span><span class="nf">bl</span><span class="w">      </span><span class="no">__pi_kaslr_early_init</span>
<span class="w">        </span><span class="nf">and</span><span class="w">     </span><span class="no">x24</span><span class="p">,</span><span class="w"> </span><span class="no">x0</span><span class="p">,</span><span class="w"> </span><span class="c1">#SZ_2M - 1             // capture memstart offset seed</span>
<span class="w">        </span><span class="nf">bic</span><span class="w">     </span><span class="no">x0</span><span class="p">,</span><span class="w"> </span><span class="no">x0</span><span class="p">,</span><span class="w"> </span><span class="c1">#SZ_2M - 1</span>
<span class="w">        </span><span class="nf">orr</span><span class="w">     </span><span class="no">x23</span><span class="p">,</span><span class="w"> </span><span class="no">x23</span><span class="p">,</span><span class="w"> </span><span class="no">x0</span><span class="w">                    </span><span class="c1">// record kernel offset</span>
<span class="c1">#endif</span>
</pre></div>
<!--  -->
<blockquote>
因为这个时候不能直接调用C代码，因为没有设置好栈。这里为了能够调用下面的C代码，临时使用init_pg_end的这个页表区域作为临时栈，就可以调用如下C 代码：</blockquote>
<div class="highlight"><pre><span></span><span class="n">asmlinkage</span><span class="w"> </span><span class="n">u64</span><span class="w"> </span><span class="n">kaslr_early_init</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">fdt</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">        </span><span class="n">u64</span><span class="w"> </span><span class="n">seed</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_kaslr_disabled_cmdline</span><span class="p">(</span><span class="n">fdt</span><span class="p">))</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<div class="section" id="init-task">
<h2>init_task 阶段</h2>
<p>在这个阶段，x21还是fdt的PA，而x22是对应的VA。在函数__primary_switched 中，首先把x21对应的PA存到__fdt_pointer 这个变量中，setup_arch-&gt;setup_machine_fdt 来把这个PA映射成0xffffxxxxxxxxxxxx的地址。</p>
<div class="highlight"><pre><span></span><span class="nf">SYM_FUNC_START_LOCAL</span><span class="p">(</span><span class="no">__primary_switched</span><span class="p">)</span>
<span class="w">        </span><span class="nf">adr_l</span><span class="w">   </span><span class="no">x4</span><span class="p">,</span><span class="w"> </span><span class="no">init_task</span>
<span class="w">        </span><span class="nf">init_cpu_task</span><span class="w"> </span><span class="no">x4</span><span class="p">,</span><span class="w"> </span><span class="no">x5</span><span class="p">,</span><span class="w"> </span><span class="no">x6</span>

<span class="w">        </span><span class="nf">adr_l</span><span class="w">   </span><span class="no">x8</span><span class="p">,</span><span class="w"> </span><span class="no">vectors</span><span class="w">                     </span><span class="c1">// load VBAR_EL1 with virtual</span>
<span class="w">        </span><span class="nf">msr</span><span class="w">     </span><span class="no">vbar_el1</span><span class="p">,</span><span class="w"> </span><span class="no">x8</span><span class="w">                    </span><span class="c1">// vector table address</span>
<span class="w">        </span><span class="nf">isb</span>

<span class="w">        </span><span class="nf">stp</span><span class="w">     </span><span class="no">x29</span><span class="p">,</span><span class="w"> </span><span class="no">x30</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">sp</span><span class="p">,</span><span class="w"> </span><span class="mi">#-16</span><span class="p">]!</span>
<span class="w">        </span><span class="nf">mov</span><span class="w">     </span><span class="no">x29</span><span class="p">,</span><span class="w"> </span><span class="no">sp</span>

<span class="w">        </span><span class="nf">str_l</span><span class="w">   </span><span class="no">x21</span><span class="p">,</span><span class="w"> </span><span class="no">__fdt_pointer</span><span class="p">,</span><span class="w"> </span><span class="no">x5</span><span class="w">          </span><span class="c1">// Save FDT pointer</span>
</pre></div>
<p>在__primary_switched，我们已经把task 切换到init_task，这个时候对应的mm是init_mm：</p>
<div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">task_struct</span><span class="w"> </span><span class="n">init_task</span><span class="w"> </span><span class="nf">__aligned</span><span class="p">(</span><span class="n">L1_CACHE_BYTES</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="c1">//...</span>
<span class="w">        </span><span class="p">.</span><span class="n">mm</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="p">.</span><span class="n">active_mm</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">init_mm</span><span class="p">,</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">mm_struct</span><span class="w"> </span><span class="n">init_mm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//...</span>
<span class="w">        </span><span class="n">INIT_MM_CONTEXT</span><span class="p">(</span><span class="n">init_mm</span><span class="p">)</span>
<span class="p">};</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="cp">#define INIT_MM_CONTEXT(name)   \</span>
<span class="cp">        .pgd = init_pg_dir,</span>
</pre></div>
<p>可以看到这个task的pgd被初始化成了init_pg_dir，这也就是在调用early_fdt_map 的时候，没有给MMU的页表的基地址的原因。
但是init_pg_dir这个区域的大小是根据kernel image的大小已经确定好了的，如果想要在early_fdt_map 函数里面增加fdt的mapping，那么就需要额外分配页表。
在进行fdt的mapping的时候，根据VA的不同，这里就需要用到中间或者最后一级的页表，而这个时候memblock又没有ready，所以这个时候只能是静态分配的,参考 arch/arm64/mm/fixmap.c：</p>
<div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="n">pte_t</span><span class="w"> </span><span class="n">bm_pte</span><span class="p">[</span><span class="n">NR_BM_PTE_TABLES</span><span class="p">][</span><span class="n">PTRS_PER_PTE</span><span class="p">]</span><span class="w"> </span><span class="n">__page_aligned_bss</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="n">pmd_t</span><span class="w"> </span><span class="n">bm_pmd</span><span class="p">[</span><span class="n">PTRS_PER_PMD</span><span class="p">]</span><span class="w"> </span><span class="n">__page_aligned_bss</span><span class="w"> </span><span class="n">__maybe_unused</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="n">pud_t</span><span class="w"> </span><span class="n">bm_pud</span><span class="p">[</span><span class="n">PTRS_PER_PUD</span><span class="p">]</span><span class="w"> </span><span class="n">__page_aligned_bss</span><span class="w"> </span><span class="n">__maybe_unused</span><span class="p">;</span>
</pre></div>
<p>在函数early_fixmap_init 建立FDT页表的时候，都是使用的上面几个静态的页表。调用完 __primary_switched-&gt; early_fdt_map-&gt; early_fixmap_init();之后，可以看到FIXADDR并没有和PA链接起来，页表如下：</p>
<div class="highlight"><pre><span></span>&gt;mmu<span class="w"> </span>print<span class="w"> </span>EL1N_S1_TTBR1_EL1<span class="w"> </span><span class="nv">TTBR1_EL1</span><span class="o">=</span>0x00000000865DA000
Input<span class="w"> </span>Address<span class="w">            </span><span class="p">|</span><span class="w"> </span>Type<span class="w">           </span><span class="p">|</span><span class="w"> </span>Next<span class="w"> </span>Level<span class="w">            </span><span class="p">|</span><span class="w"> </span>Output<span class="w"> </span>Address<span class="w">        </span><span class="p">|</span><span class="w"> </span>Properties
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
+<span class="w"> </span>0xFFFF000000000000<span class="w">     </span><span class="p">|</span><span class="w"> </span>TTBR1_EL1<span class="w">      </span><span class="p">|</span><span class="w"> </span>NP:0x00000000865DA000<span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span><span class="nv">TBI1</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">TBI0</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">AS</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">IPS</span><span class="o">=</span>256TB,<span class="w"> </span><span class="nv">TG1</span><span class="o">=</span>4KB,<span class="w"> </span><span class="nv">SH1</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">ORGN1</span><span class="o">=</span>0x1,<span class="w"> </span><span class="nv">IRGN1</span><span class="o">=</span>0x1,<span class="w"> </span><span class="nv">EPD1</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">A1</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">T1SZ</span><span class="o">=</span><span class="m">16</span>,<span class="w"> </span><span class="nv">TG0</span><span class="o">=</span>4KB,<span class="w"> </span><span class="nv">SH0</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">ORGN0</span><span class="o">=</span>0x1,<span class="w"> </span><span class="nv">IRGN0</span><span class="o">=</span>0x1,<span class="w"> </span><span class="nv">EPD0</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">T0SZ</span><span class="o">=</span><span class="m">16</span>,<span class="w"> </span><span class="nv">HPD1</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">HPD0</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">HD</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">HA</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">CnP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">ASID</span><span class="o">=</span><span class="m">0</span>
<span class="w"> </span>-<span class="w"> </span>0xFFFF000000000000<span class="w">    </span><span class="p">|</span><span class="w"> </span>Invalid<span class="w"> </span><span class="o">(</span>x256<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>
<span class="w"> </span>+<span class="w"> </span>0xFFFF800000000000<span class="w">    </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">0</span><span class="w"> </span>Table<span class="w">  </span><span class="p">|</span><span class="w"> </span>NP:0x00000000865DB000<span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span><span class="nv">APTable</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">UXNTable</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXNTable</span><span class="o">=</span><span class="m">0</span>
<span class="w">  </span>+<span class="w"> </span>0xFFFF800000000000<span class="w">   </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">1</span><span class="w"> </span>Table<span class="w">  </span><span class="p">|</span><span class="w"> </span>NP:0x00000000865DC000<span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span><span class="nv">APTable</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">UXNTable</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXNTable</span><span class="o">=</span><span class="m">0</span>
<span class="w">   </span>-<span class="w"> </span>0xFFFF800000000000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Invalid<span class="w"> </span><span class="o">(</span>x64<span class="o">)</span><span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>
<span class="w">   </span>-<span class="w"> </span>0xFFFF800008000000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000084000000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800008200000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000084200000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800008400000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000084400000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800008600000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000084600000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800008800000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000084800000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800008A00000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000084A00000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800008C00000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000084C00000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800008E00000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000084E00000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800009000000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000085000000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800009200000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000085200000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800009400000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000085400000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800009600000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000085600000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800009800000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000085800000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800009A00000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000085A00000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800009C00000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000085C00000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800009E00000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000085E00000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF80000A000000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000086000000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF80000A200000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000086200000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF80000A400000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000086400000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF80000A600000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Invalid<span class="w"> </span><span class="o">(</span>x429<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>
<span class="w">  </span>-<span class="w"> </span>0xFFFF800040000000<span class="w">   </span><span class="p">|</span><span class="w"> </span>Invalid<span class="w"> </span><span class="o">(</span>x511<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>
<span class="w"> </span>-<span class="w"> </span>0xFFFF808000000000<span class="w">    </span><span class="p">|</span><span class="w"> </span>Invalid<span class="w"> </span><span class="o">(</span>x246<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>
<span class="w"> </span>+<span class="w"> </span>0xFFFFFB8000000000<span class="w">    </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">0</span><span class="w"> </span>Table<span class="w">  </span><span class="p">|</span><span class="w"> </span>NP:0x0000000086542000<span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span><span class="nv">APTable</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">UXNTable</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXNTable</span><span class="o">=</span><span class="m">0</span>
<span class="w">  </span>-<span class="w"> </span>0xFFFFFB8000000000<span class="w">   </span><span class="p">|</span><span class="w"> </span>Invalid<span class="w"> </span><span class="o">(</span>x511<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>
<span class="w">  </span>+<span class="w"> </span>0xFFFFFBFFC0000000<span class="w">   </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">1</span><span class="w"> </span>Table<span class="w">  </span><span class="p">|</span><span class="w"> </span>NP:0x0000000086543000<span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span><span class="nv">APTable</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">UXNTable</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXNTable</span><span class="o">=</span><span class="m">0</span>
<span class="w">   </span>-<span class="w"> </span>0xFFFFFBFFC0000000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Invalid<span class="w"> </span><span class="o">(</span>x493<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>
<span class="w">   </span>+<span class="w"> </span>0xFFFFFBFFFDA00000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Table<span class="w">  </span><span class="p">|</span><span class="w"> </span>NP:0x0000000086544000<span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span><span class="nv">APTable</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">UXNTable</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXNTable</span><span class="o">=</span><span class="m">0</span>
<span class="w">    </span>-<span class="w"> </span>0xFFFFFBFFFDA00000<span class="w"> </span><span class="p">|</span><span class="w"> </span>Invalid<span class="w"> </span><span class="o">(</span>x512<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>
<span class="w">   </span>-<span class="w"> </span>0xFFFFFBFFFDC00000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Invalid<span class="w"> </span><span class="o">(</span>x18<span class="o">)</span><span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>
<span class="w"> </span>-<span class="w"> </span>0xFFFFFC0000000000<span class="w">    </span><span class="p">|</span><span class="w"> </span>Invalid<span class="w"> </span><span class="o">(</span>x8<span class="o">)</span><span class="w">   </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>
</pre></div>
<p>0x0000000086542000  0x0000000086543000 等地址就是bm_pud， bm_pmd 的地址。
在__primary_switched-&gt; early_fdt_map-&gt;fixmap_remap_fdt 调用完成之后，fdt的PA就和VA给对应起来了，页表如下：</p>
<div class="highlight"><pre><span></span>&gt;mmu<span class="w"> </span>print<span class="w"> </span>EL1N_S1_TTBR1_EL1<span class="w"> </span><span class="nv">TTBR1_EL1</span><span class="o">=</span>0x00000000865DA000
Input<span class="w"> </span>Address<span class="w">            </span><span class="p">|</span><span class="w"> </span>Type<span class="w">           </span><span class="p">|</span><span class="w"> </span>Next<span class="w"> </span>Level<span class="w">            </span><span class="p">|</span><span class="w"> </span>Output<span class="w"> </span>Address<span class="w">        </span><span class="p">|</span><span class="w"> </span>Properties
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
+<span class="w"> </span>0xFFFF000000000000<span class="w">     </span><span class="p">|</span><span class="w"> </span>TTBR1_EL1<span class="w">      </span><span class="p">|</span><span class="w"> </span>NP:0x00000000865DA000<span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span><span class="nv">TBI1</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">TBI0</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">AS</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">IPS</span><span class="o">=</span>256TB,<span class="w"> </span><span class="nv">TG1</span><span class="o">=</span>4KB,<span class="w"> </span><span class="nv">SH1</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">ORGN1</span><span class="o">=</span>0x1,<span class="w"> </span><span class="nv">IRGN1</span><span class="o">=</span>0x1,<span class="w"> </span><span class="nv">EPD1</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">A1</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">T1SZ</span><span class="o">=</span><span class="m">16</span>,<span class="w"> </span><span class="nv">TG0</span><span class="o">=</span>4KB,<span class="w"> </span><span class="nv">SH0</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">ORGN0</span><span class="o">=</span>0x1,<span class="w"> </span><span class="nv">IRGN0</span><span class="o">=</span>0x1,<span class="w"> </span><span class="nv">EPD0</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">T0SZ</span><span class="o">=</span><span class="m">16</span>,<span class="w"> </span><span class="nv">HPD1</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">HPD0</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">HD</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">HA</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">CnP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">ASID</span><span class="o">=</span><span class="m">0</span>
<span class="w"> </span>-<span class="w"> </span>0xFFFF000000000000<span class="w">    </span><span class="p">|</span><span class="w"> </span>Invalid<span class="w"> </span><span class="o">(</span>x256<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>
<span class="w"> </span>+<span class="w"> </span>0xFFFF800000000000<span class="w">    </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">0</span><span class="w"> </span>Table<span class="w">  </span><span class="p">|</span><span class="w"> </span>NP:0x00000000865DB000<span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span><span class="nv">APTable</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">UXNTable</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXNTable</span><span class="o">=</span><span class="m">0</span>
<span class="w">  </span>+<span class="w"> </span>0xFFFF800000000000<span class="w">   </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">1</span><span class="w"> </span>Table<span class="w">  </span><span class="p">|</span><span class="w"> </span>NP:0x00000000865DC000<span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span><span class="nv">APTable</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">UXNTable</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXNTable</span><span class="o">=</span><span class="m">0</span>
<span class="w">   </span>-<span class="w"> </span>0xFFFF800000000000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Invalid<span class="w"> </span><span class="o">(</span>x64<span class="o">)</span><span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>
<span class="w">   </span>-<span class="w"> </span>0xFFFF800008000000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000084000000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800008200000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000084200000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800008400000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000084400000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800008600000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000084600000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800008800000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000084800000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800008A00000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000084A00000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800008C00000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000084C00000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800008E00000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000084E00000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800009000000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000085000000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800009200000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000085200000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800009400000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000085400000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800009600000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000085600000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800009800000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000085800000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800009A00000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000085A00000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800009C00000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000085C00000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF800009E00000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000085E00000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF80000A000000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000086000000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF80000A200000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000086200000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF80000A400000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000086400000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFF80000A600000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Invalid<span class="w"> </span><span class="o">(</span>x429<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>
<span class="w">  </span>-<span class="w"> </span>0xFFFF800040000000<span class="w">   </span><span class="p">|</span><span class="w"> </span>Invalid<span class="w"> </span><span class="o">(</span>x511<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>
<span class="w"> </span>-<span class="w"> </span>0xFFFF808000000000<span class="w">    </span><span class="p">|</span><span class="w"> </span>Invalid<span class="w"> </span><span class="o">(</span>x246<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>
<span class="w"> </span>+<span class="w"> </span>0xFFFFFB8000000000<span class="w">    </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">0</span><span class="w"> </span>Table<span class="w">  </span><span class="p">|</span><span class="w"> </span>NP:0x0000000086542000<span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span><span class="nv">APTable</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">UXNTable</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXNTable</span><span class="o">=</span><span class="m">0</span>
<span class="w">  </span>-<span class="w"> </span>0xFFFFFB8000000000<span class="w">   </span><span class="p">|</span><span class="w"> </span>Invalid<span class="w"> </span><span class="o">(</span>x511<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>
<span class="w">  </span>+<span class="w"> </span>0xFFFFFBFFC0000000<span class="w">   </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">1</span><span class="w"> </span>Table<span class="w">  </span><span class="p">|</span><span class="w"> </span>NP:0x0000000086543000<span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span><span class="nv">APTable</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">UXNTable</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXNTable</span><span class="o">=</span><span class="m">0</span>
<span class="w">   </span>-<span class="w"> </span>0xFFFFFBFFC0000000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Invalid<span class="w"> </span><span class="o">(</span>x493<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>
<span class="w">   </span>+<span class="w"> </span>0xFFFFFBFFFDA00000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Table<span class="w">  </span><span class="p">|</span><span class="w"> </span>NP:0x0000000086544000<span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span><span class="nv">APTable</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">UXNTable</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">PXNTable</span><span class="o">=</span><span class="m">0</span>
<span class="w">    </span>-<span class="w"> </span>0xFFFFFBFFFDA00000<span class="w"> </span><span class="p">|</span><span class="w"> </span>Invalid<span class="w"> </span><span class="o">(</span>x512<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>
<span class="w">   </span>-<span class="w"> </span>0xFFFFFBFFFDC00000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Level<span class="w"> </span><span class="m">2</span><span class="w"> </span>Block<span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>NP:0x0000000082000000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">UXN</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">PXN</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">Contiguous</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">DBM</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">GP</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">nG</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">AF</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">SH</span><span class="o">=</span>0x3,<span class="w"> </span><span class="nv">AP</span><span class="o">=</span>0x0,<span class="w"> </span><span class="nv">AttrIndx</span><span class="o">=</span>0x0
<span class="w">   </span>-<span class="w"> </span>0xFFFFFBFFFDE00000<span class="w">  </span><span class="p">|</span><span class="w"> </span>Invalid<span class="w"> </span><span class="o">(</span>x17<span class="o">)</span><span class="w">  </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>
<span class="w"> </span>-<span class="w"> </span>0xFFFFFC0000000000<span class="w">    </span><span class="p">|</span><span class="w"> </span>Invalid<span class="w"> </span><span class="o">(</span>x8<span class="o">)</span><span class="w">   </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>
</pre></div>
<p>0x0000000082000000 就是之前保存在x21，再用x0传给early_fdt_map的。 代码如下：</p>
<div class="highlight"><pre><span></span><span class="nf">SYM_FUNC_START_LOCAL</span><span class="p">(</span><span class="no">__primary_switched</span><span class="p">)</span>
<span class="c1">//...</span>
<span class="w">        </span><span class="nf">mov</span><span class="w">     </span><span class="no">x0</span><span class="p">,</span><span class="w"> </span><span class="no">x21</span><span class="w">                         </span><span class="c1">// pass FDT address in x0</span>
<span class="w">        </span><span class="nf">bl</span><span class="w">      </span><span class="no">early_fdt_map</span><span class="w">                   </span><span class="c1">// Try mapping the FDT early</span>
<span class="w">        </span><span class="nf">mov</span><span class="w">     </span><span class="no">x0</span><span class="p">,</span><span class="w"> </span><span class="no">x20</span><span class="w">                         </span><span class="c1">// pass the full boot status</span>
<span class="w">        </span><span class="nf">bl</span><span class="w">      </span><span class="no">init_feature_override</span><span class="w">           </span><span class="c1">// Parse cpu feature overrides</span>
</pre></div>
<p>这个时候映射的FDT的页表，只给函数init_feature_override使用。 这些FDT(也就是fixed map)的页表用完之后也不会释放，会被复制到最终的页表(swapper_pg_dir)里面：
setup_arch-&gt;paging_init-&gt;map_kernel-&gt;fixmap_copy:</p>
<div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">__init</span><span class="w"> </span><span class="nf">fixmap_copy</span><span class="p">(</span><span class="n">pgd_t</span><span class="w"> </span><span class="o">*</span><span class="n">pgdir</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">READ_ONCE</span><span class="p">(</span><span class="n">pgd_val</span><span class="p">(</span><span class="o">*</span><span class="n">pgd_offset_pgd</span><span class="p">(</span><span class="n">pgdir</span><span class="p">,</span><span class="w"> </span><span class="n">FIXADDR_TOT_START</span><span class="p">))))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="cm">/*</span>
<span class="cm">                 * The fixmap falls in a separate pgd to the kernel, and doesn&#39;t</span>
<span class="cm">                 * live in the carveout for the swapper_pg_dir. We can simply</span>
<span class="cm">                 * re-use the existing dir for the fixmap.</span>
<span class="cm">                 */</span>
<span class="w">                </span><span class="n">set_pgd</span><span class="p">(</span><span class="n">pgd_offset_pgd</span><span class="p">(</span><span class="n">pgdir</span><span class="p">,</span><span class="w"> </span><span class="n">FIXADDR_TOT_START</span><span class="p">),</span>
<span class="w">                        </span><span class="n">READ_ONCE</span><span class="p">(</span><span class="o">*</span><span class="n">pgd_offset_k</span><span class="p">(</span><span class="n">FIXADDR_TOT_START</span><span class="p">)));</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">CONFIG_PGTABLE_LEVELS</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">pgd_t</span><span class="w"> </span><span class="o">*</span><span class="n">bm_pgdp</span><span class="p">;</span>
<span class="w">                </span><span class="n">p4d_t</span><span class="w"> </span><span class="o">*</span><span class="n">bm_p4dp</span><span class="p">;</span>
<span class="w">                </span><span class="n">pud_t</span><span class="w"> </span><span class="o">*</span><span class="n">bm_pudp</span><span class="p">;</span>
<span class="w">                </span><span class="cm">/*</span>
<span class="cm">                 * The fixmap shares its top level pgd entry with the kernel</span>
<span class="cm">                 * mapping. This can really only occur when we are running</span>
<span class="cm">                 * with 16k/4 levels, so we can simply reuse the pud level</span>
<span class="cm">                 * entry instead.</span>
<span class="cm">                 */</span>
<span class="w">                </span><span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="n">IS_ENABLED</span><span class="p">(</span><span class="n">CONFIG_ARM64_16K_PAGES</span><span class="p">));</span>
<span class="w">                </span><span class="n">bm_pgdp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pgd_offset_pgd</span><span class="p">(</span><span class="n">pgdir</span><span class="p">,</span><span class="w"> </span><span class="n">FIXADDR_TOT_START</span><span class="p">);</span>
<span class="w">                </span><span class="n">bm_p4dp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p4d_offset</span><span class="p">(</span><span class="n">bm_pgdp</span><span class="p">,</span><span class="w"> </span><span class="n">FIXADDR_TOT_START</span><span class="p">);</span>
<span class="w">                </span><span class="n">bm_pudp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pud_set_fixmap_offset</span><span class="p">(</span><span class="n">bm_p4dp</span><span class="p">,</span><span class="w"> </span><span class="n">FIXADDR_TOT_START</span><span class="p">);</span>
<span class="w">                </span><span class="n">pud_populate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">init_mm</span><span class="p">,</span><span class="w"> </span><span class="n">bm_pudp</span><span class="p">,</span><span class="w"> </span><span class="n">lm_alias</span><span class="p">(</span><span class="n">bm_pmd</span><span class="p">));</span>
<span class="w">                </span><span class="n">pud_clear_fixmap</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">BUG</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="setup-arch">
<h2>setup_arch阶段</h2>
<p>函数setup_arch-&gt; early_fixmap_init其实是可以不用调用的，因为在__primary_switched-&gt; early_fdt_map -&gt; early_fixmap_init 已经调用了这个函数，并且这个时候的页表并没有什么变化。所以其实是可以不用调用的。</p>
<p>在setup_arch 阶段，这里会最终设置FDT的页表，就是在setup_arch-&gt; setup_machine_fdt -&gt; fixmap_remap_fdt ,但是这个fixmap_remap_fdt 其实不是必须的，因为在上面的流程里面，已经把FDT 的VA-&gt;PA给mapping上了。
最终的页表页不会有任何变化。</p>
<div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">__init</span><span class="w"> </span><span class="nf">setup_machine_fdt</span><span class="p">(</span><span class="n">phys_addr_t</span><span class="w"> </span><span class="n">dt_phys</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">dt_virt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fixmap_remap_fdt</span><span class="p">(</span><span class="n">dt_phys</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">PAGE_KERNEL</span><span class="p">);</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">;</span>
</pre></div>
<p>最终，FDT的VA地址赋给了变量 initial_boot_params， 在函数 setup_machine_fdt-&gt; early_init_dt_scan-&gt; early_init_dt_verify, 后面就用这个变量来解析FDT了。</p>
<div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">__init</span><span class="w"> </span><span class="nf">setup_machine_fdt</span><span class="p">(</span><span class="n">phys_addr_t</span><span class="w"> </span><span class="n">dt_phys</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">dt_virt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fixmap_remap_fdt</span><span class="p">(</span><span class="n">dt_phys</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">PAGE_KERNEL</span><span class="p">);</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dt_virt</span><span class="p">)</span>
<span class="w">                </span><span class="n">memblock_reserve</span><span class="p">(</span><span class="n">dt_phys</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">dt_virt</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">early_init_dt_scan</span><span class="p">(</span><span class="n">dt_virt</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">//..</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="cm">/* Early fixups are done, map the FDT as read-only now */</span>
<span class="w">        </span><span class="n">fixmap_remap_fdt</span><span class="p">(</span><span class="n">dt_phys</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">PAGE_KERNEL_RO</span><span class="p">);</span>
</pre></div>
<p>接下来就是从init_pg_dir转换到swapper_pg_dir这个页，前面讲过会把FDT的页表接上swapper_pg_dir，不需要重新映射，调用过程：
setup_arch-&gt;paging_init-&gt;map_kernel-&gt;fixmap_copy。
这样FDT就完成了在正式的页表里面的映射。</p>
</div>

    </div><!-- /.entry-content -->
    <div class="comments">
      <h2>Comments !</h2>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_identifier = "posts/2024/05/fdt_mapping.html";
        var disqus_url = "https://geesun.github.io/posts/2024/05/fdt_mapping.html";
        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//geesun.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
    </div>

  </article>
</section>

        <footer id="contentinfo" class="body">
                <p>&copy; 2024 Qixiang Xu</p>
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'geesun';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>